<!DOCTYPE html>
<html>
    <head>
        <title>Testing</title>
    </head>
    <body>
        <h1>Fuck my life</h1>
        
        <button id="note-btn">Одна нота</button>
        <button id="play-btn">Проиграть композицию</button>
        <button id="clear-btn">Очистить композицию</button>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
        <script>
            const noteButton = document.getElementById("note-btn");  // Референс к кнопке
            const playButton = document.getElementById("play-btn");  // Референс к кнопке
            const clearButton = document.getElementById("clear-btn");  // Референс к кнопке

            const synth = new Tone.Synth().toDestination();  // Создаем синтезатор (toDestination чтобы звук играл из выхода)
            
            var notes = [
                    { pitch: "E4", timing: 0, duration: "4n" },
                    { pitch: "D#4", timing: 0.4, duration: "4n" },
                    { pitch: "E4", timing: 0.4, duration: "4n" },
                    { pitch: "D#4", timing: 0.4, duration: "4n" },
                    { pitch: "E4", timing: 0.4, duration: "4n" },
                    { pitch: "B3", timing: 0.4, duration: "4n" },
                    { pitch: "D4", timing: 0.4, duration: "4n" },
                    { pitch: "C4", timing: 0.4, duration: "4n" },
                    { pitch: "A3", timing: 0.4, duration: "2n" }
                ];

            noteButton.addEventListener("click", () => {  // Функция для клика кнопки
                if (Tone.context.state != "running")
                {
                    Tone.start();  // Браузеры блокируют автопроигрывание звука, так что включаем его, если он не включен
                }

                synth.triggerAttackRelease("E4", "8n");  // Играем ноту Рэ в 4 октаве с длительностью 1/8
            });

            clearButton.addEventListener("click", () => {
                notes = [];
                notes.forEach(element => {
                    console.log(element);
                });
            });

            playButton.addEventListener("click", () => {  // Функция для клика кнопки
                if (Tone.context.state != "running")
                {
                    Tone.start();  // Браузеры блокируют автопроигрывание звука, так что включаем его, если он не включен
                }

                function play() {
                    let delay = Tone.now();
                    for(let i = 0; i < notes.length; i++) {
                        delay += notes[i].timing;
                        synth.triggerAttackRelease(notes[i].pitch, notes[i].duration, delay);  
                    }
                }

                play()
            });

            console.log(Tone.context.state);  // Вывод статуса для тестирования
        </script>
    </body>
</html>    